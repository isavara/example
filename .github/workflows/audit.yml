name: Audit

on:
  push:
    branches:
      - 'BFUEM-*'
      - main      
  pull_request:
    branches:
      - main
    branches-ignore:
      - 'v*.*'

jobs:
  build:
    name: Perform golint and go-staticcheck
    runs-on: gcp-public-runner-label-1
    steps:
      - name: Print Step#1
        run: echo "The job build is running...."       
      - name: Print PATH
        run: echo $PATH

  update-mcm-gke:
    name: Update MCM on GKE
    runs-on: gcp-public-runner-label-1
    environment: dev
    needs: build
    # Run only if the workflow was triggered by a push to the 'main' branch
    if: ${{ github.event_name == 'push' && github.ref == 'refs/heads/main' }} 
    # Also run when the pull request is merged into main
    # This ensures it runs when the PR targeting 'main' is merged
    if: ${{ github.event_name == 'pull_request' && github.ref == 'refs/heads/main' }}

    steps:
      - name: Print Step#1 in deploy-mcm-gke job
        run: echo "The job update-mcm-gke is running..."       
      - name: Print PATH
        run: echo $PATH
